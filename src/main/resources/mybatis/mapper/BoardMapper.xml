<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ê²Œì‹œíŒ -->
<mapper namespace="com.example.first.mapper.BoardMapper">
    <resultMap id="boardResultMap" type="com.example.first.dto.BoardDto">
        <id property="boardId" column="board_id"/>
        <result property="userId" column="user_id"/>
        <result property="createdAt" column="created_at"/>
        <result property="fileLocation" column="file_location"/>
        <result property="fileOriginalName" column="file_original_name"/>
        <result property="cntLike" column="cnt_like"/>
    </resultMap>

    <resultMap id="CommentResultMap" type="com.example.first.dto.CommentDto">
        <id property="commentId" column="comment_id"/>
        <result property="boardId" column="board_id"/>
        <result property="parentCommentId" column="parent_comment_id"/>
        <result property="createdAt" column="created_at"/>
    </resultMap>

    <resultMap id="BoardMultiFileResultMap" type="com.example.first.dto.BoardMultiFile">
        <id property="fileId" column="seq"/>
        <result property="boardId" column="board_id"/>
        <result property="fileName" column="file_name"/>
        <result property="savePath" column="save_path"/>
        <result property="regDate" column="reg_date"/>
        <result property="fileSize" column="file_size"/>
        <result property="flagDel" column="flag_del"/>
        <result property="fileExt" column="file_ext"/>
        <result property="fileOriginalName" column="file_original_name"/>
    </resultMap>

    <resultMap id="DietResultMap" type="com.example.first.dto.DietDto">
        <id property="seq" column="seq"/>
        <result property="intakeDate" column="intake_date"/>
        <result property="username" column="username"/>
        <result property="intakeResult" column="intake_result"/>
        <result property="foodNameMorning" column="food_name_morning" />
        <result property="foodNameLunch" column="food_name_lunch"/>
        <result property="foodNameDinner" column="food_name_dinner"/>
        <result property="foodNameSnack" column="food_name_snack"/>
        <result property="intakeCaloriesMorning" column="intake_calories_morning"/>
        <result property="intakeCaloriesLunch" column="intake_calories_lunch"/>
        <result property="intakeCaloriesDinner" column="intake_calories_dinner"/>
        <result property="intakeCaloriesSnack" column="intake_calories_snack"/>
        <result property="intakeTotal" column="intake_total"/>
    </resultMap>

    <resultMap id="BoardLikeResultMap" type="com.example.first.dto.BoardLikeDto">
        <id property="seq" column="seq"/>
        <result property="boardId" column="board_id"/>
        <result property="username" column="username"/>
    </resultMap>


<!--    í˜ì´ì§€ ë³„ ê²Œì‹œíŒ ê¸€ëª©ë¡ ì¡°íšŒ-->
    <select id="getBoardsByPage" parameterType="map" resultType="com.example.first.dto.BoardDto" resultMap="boardResultMap">
        SELECT *
        FROM postgres.first_project.boards
        WHERE status = 'N'
        ORDER BY created_at DESC
        LIMIT #{pageSize} OFFSET #{offset};
    </select>


<!--    ì´ í˜ì´ì§€ ìˆ˜ ì¡°íšŒ-->
    <select id="getTotalPages" parameterType="int" resultType="int">
        SELECT CEIL(COUNT(*)::NUMERIC / #{pageSize})
        FROM postgres.first_project.boards;
    </select>


    <!-- íŠ¹ì • ê²Œì‹œê¸€ ì¡°íšŒ ì¿¼ë¦¬ -->
    <select id="getBoardById" parameterType="java.lang.Long" resultType="com.example.first.dto.BoardDto" resultMap="boardResultMap">
        SELECT * FROM postgres.first_project.boards
        WHERE board_id = #{boardId};
    </select>

    <!-- ê²Œì‹œê¸€ ìƒì„± ì¿¼ë¦¬ -->
    <select id="createBoard" parameterType="com.example.first.dto.BoardDto" resultType="java.lang.Long">
        INSERT INTO postgres.first_project.boards (title, content, status, created_at, user_id, username, nickname)
        VALUES (#{title}, #{content}, #{status}, #{createdAt}, #{userId}, #{username}, #{nickname})
        RETURNING board_id;
    </select>

    <!-- ì¢‹ì•„ìš” ì‹œ ê²Œì‹œê¸€ ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ -->
    <update id="updateBoardLikes" parameterType="com.example.first.dto.BoardDto">
        UPDATE postgres.first_project.boards
        SET cnt_like = #{cntLike}
        WHERE board_id = #{boardId};
    </update>

    <!-- ì¢‹ì•„ìš” ì‹œ ì¢‹ì•„ìš” í…Œì´ë¸”ì— ì¸ì„œíŠ¸ -->
    <select id="saveBoardLike" parameterType="com.example.first.dto.BoardLikeDto" >
        INSERT INTO postgres.first_project.board_like (board_id, username)
        VALUES ( #{boardId}, #{username})
    </select>

    <!-- ì¢‹ì•„ìš” ë‹¤ì‹œ ëˆ„ë¥´ë©´ ì¢‹ì•„ìš” í…Œì´ë¸”ì—ì„œ ì‚­ì œ -->
    <select id="deleteBoardLike" >
        DELETE
        FROM postgres.first_project.board_like
        WHERE username = #{username}
          AND board_id = #{boardId};
    </select>

    <!-- ê²Œì‹œê¸€ ì¢‹ì•„ìš” ë˜ì–´ìˆëŠ”ì§€ í™•ì¸-->
    <select id="findBoardLike" parameterType="java.lang.String" resultType="com.example.first.dto.BoardLikeDto" resultMap="BoardLikeResultMap">
        SELECT * FROM postgres.first_project.board_like
        WHERE username = #{username};
    </select>


    <!--ë©€í‹°íŒŒì¼ ì—…ë¡œë“œ (ë‹¨ì¼) - ë°˜ë³µë¬¸ ëŒë©´ì„œ ì €ì¥í•  ë•Œ í•„ìš”í•¨ -->
    <select id="storeBoardMultiFile" parameterType="com.example.first.dto.BoardMultiFile" >
        INSERT INTO postgres.first_project.board_multi_file (board_id, file_name, save_path, reg_date, flag_del, file_ext, username, file_original_name, status)
        VALUES ( #{boardId}, #{fileName}, #{savePath}, #{regDate}, #{flagDel}, #{fileExt}, #{username}, #{fileOriginalName}, #{status})
    </select>

    <!-- ë©€í‹°íŒŒì¼ ì—…ë¡œë“œ (ë‹¤ì¤‘) -->
    <insert id="storeBoardMultiFiles" parameterType="list">
        INSERT INTO postgres.first_project.board_multi_file (
        board_id, file_name, save_path, reg_date, flag_del, file_ext, username, file_original_name, status
        )
        VALUES
        <foreach item="file" collection="list" separator=",">
            (
            #{file.boardId},
            #{file.fileName},
            #{file.savePath},
            #{file.regDate},
            #{file.flagDel},
            #{file.fileExt},
            #{file.username},
            #{file.fileOriginalName},
            #{file.status}
            )
        </foreach>
    </insert>

    <!-- ë©€í‹°íŒŒì¼ ì‚­ì œ (flagDel = "Y" ë¡œ) -->
    <update id="updateMultiFilesFlagDel" parameterType="com.example.first.dto.BoardMultiFile"  >
        UPDATE postgres.first_project.board_multi_file
        SET flag_del = 'Y'
        WHERE file_original_name = #{file_original_name};
    </update>


    <!-- íŠ¹ì • ê²Œì‹œê¸€ì˜ ëª¨ë“  ë©€í‹°íŒŒì¼ file_original_name ì¡°íšŒ ì¿¼ë¦¬ -->
    <select id="findAllMultiFilesName" parameterType="java.lang.Long" resultType="String" >
        SELECT file_original_name
        FROM postgres.first_project.board_multi_file
        WHERE board_id = #{boardId}
        AND flag_del = 'N';
    </select>





    <!-- ê²Œì‹œê¸€ ìˆ˜ì • ì¿¼ë¦¬ -->
    <update id="updateBoard" parameterType="com.example.first.dto.BoardDto">
        UPDATE postgres.first_project.boards
        SET title = #{title}, content = #{content}, status = #{status}, created_at = #{createdAt}, user_id = #{userId}
        WHERE board_id = #{boardId};
    </update>


    <!-- ê²Œì‹œê¸€ ì‚­ì œ ì¿¼ë¦¬ -->
    <delete id="deleteBoard" parameterType="java.lang.Long">
        UPDATE postgres.first_project.boards
        SET status = 'Y'
        WHERE board_id = #{boardId};
    </delete>

    <!-- ê²Œì‹œê¸€ ê²€ìƒ‰  (í˜ì´ì§• ì ìš©) -->
    <select id="getSearchBoardsByPage" parameterType="map" resultType="com.example.first.dto.BoardDto" resultMap="boardResultMap">
        SELECT *
        FROM postgres.first_project.boards
        WHERE status = 'N'
        AND
            (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'))
        ORDER BY created_at DESC
            LIMIT #{pageSize} OFFSET #{offset};
    </select>

    <!--   ê²€ìƒ‰ëœ ê¸€ì˜ ì´ í˜ì´ì§€ ìˆ˜ ì¡°íšŒ (í˜ì´ì§• ì ìš©) -->
    <select id="getSearchBoardsTotalPages" parameterType="map" resultType="int">
        SELECT CEIL(COUNT(*)::NUMERIC / #{pageSize})
        FROM postgres.first_project.boards
        WHERE status = 'N'
          AND
            (title LIKE CONCAT('%', #{keyword}, '%') OR content LIKE CONCAT('%', #{keyword}, '%'));
    </select>

    <!-- íŠ¹ì • ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ì¡°íšŒ ì¿¼ë¦¬ -->
    <select id="getAllCommentsByBoardId" parameterType="java.lang.Long" resultType="com.example.first.dto.CommentDto" resultMap="CommentResultMap">
        SELECT * FROM postgres.first_project.comments
        WHERE board_id = #{boardId};
    </select>

    <!-- ëª¨ë“  ê²Œì‹œê¸€ì˜ ëŒ“ê¸€ ì¡°íšŒ ì¿¼ë¦¬ -->
    <select id="getAllComments"  resultType="com.example.first.dto.CommentDto" resultMap="CommentResultMap">
        SELECT * FROM postgres.first_project.comments
        WHERE status = 'N';
    </select>


    <!-- ê³„ì¸µí˜• ëŒ“ê¸€ ì¡°íšŒ ì¿¼ë¦¬ -->
    <select id="getHierarchicalCommentsByBoardId" parameterType="java.lang.Long" resultType="com.example.first.dto.CommentDto">
        WITH RECURSIVE CommentHierarchy(commentId, boardId, content, createdAt, username, nickname, parentCommentId, status, level, path, cycle) AS (
            --ğŸ”¥ 1. ê³„ì¸µêµ¬ì¡°ì˜ ì‹œì‘ì¡°ê±´ ì¿¼ë¦¬ ğŸ”¥ (ìµœìƒìœ„ ëŒ“ê¸€ì„ ì‹œì‘ìœ¼ë¡œ ì¬ê·€ì ìœ¼ë¡œ ëŒ“ê¸€ ê³„ì¸µì„ ì¡°íšŒí•©ë‹ˆë‹¤.)
            SELECT
                b.comment_id AS commentId,
                b.board_id AS boardId,
                b.content,
                b.created_at AS createdAt,
                b.username,
                b.nickname,
                b.parent_comment_id AS parentCommentId,
                b.status,
                1, -- ìµœìƒìœ„ ëŒ“ê¸€ì˜ ë ˆë²¨ì€ 1ë¡œ ì‹œì‘í•©ë‹ˆë‹¤.
                array[b.comment_id], -- ìµœìƒìœ„ ëŒ“ê¸€ì˜ ê²½ë¡œ(path)ë¥¼ ë°°ì—´ë¡œ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
                false -- ì‚¬ì´í´ ì—¬ë¶€ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
            FROM
                postgres.first_project.comments b
            WHERE
                board_id = #{boardId} -- íŠ¹ì • ê²Œì‹œê¸€(board)ì— ì†í•œ ëŒ“ê¸€ë“¤ì„ ì¡°íšŒí•©ë‹ˆë‹¤.
              AND
                parent_comment_id IS NULL -- ìµœìƒìœ„ ëŒ“ê¸€ë§Œ ì‹œì‘ì ìœ¼ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
              AND
                status = 'N' -- í™œì„±í™”ëœ ëŒ“ê¸€ë§Œ ì¡°íšŒí•©ë‹ˆë‹¤.
            UNION ALL

            --ğŸ”¥ 2. í•˜ìœ„ ë°ì´í„°ë¥¼ ì°¾ì•„ê°€ê¸°ìœ„í•œ ë°˜ë³µì¡°ê±´ ì¿¼ë¦¬ ğŸ”¥ (ì¬ê·€ì ìœ¼ë¡œ í•˜ìœ„ ëŒ“ê¸€ì„ ì¡°íšŒí•©ë‹ˆë‹¤.)
            SELECT
                c.comment_id AS commentId,
                c.board_id AS boardId,
                c.content,
                c.created_at AS createdAt,
                c.username,
                c.nickname,
                c.parent_comment_id AS parentCommentId,
                c.status,
                ch.level + 1, -- ìƒìœ„ ëŒ“ê¸€ ë ˆë²¨ì— 1ì„ ë”í•˜ì—¬ í•˜ìœ„ ëŒ“ê¸€ì˜ ë ˆë²¨ì„ ì„¤ì •í•©ë‹ˆë‹¤.
                array_append(ch.path, c.comment_id), -- ìƒìœ„ ëŒ“ê¸€ì˜ ê²½ë¡œì— í˜„ì¬ ëŒ“ê¸€ì„ ì¶”ê°€í•©ë‹ˆë‹¤.
                c.comment_id = ANY(ch.path) -- PATH ë°°ì—´ì— ìì‹ ì˜ IDê°’ì´ ìˆëŠ” ì§€ë¥¼ ê²€ì‚¬í•˜ì—¬, ì´ë¯¸ ì°¾ì€ ê°’ì— ëŒ€í•´ì„œëŠ” ë” ì´ìƒ ë°ì´í„° ê²€ìƒ‰ì„ ìˆ˜í–‰í•˜ì§€ ì•Šë„ë¡ í•¨.
            FROM
                postgres.first_project.comments c
                INNER JOIN
                CommentHierarchy ch
                ON
                    c.parent_comment_id = ch.commentId
            WHERE
                c.parent_comment_id = ch.commentId -- ìƒìœ„ ëŒ“ê¸€ê³¼ í˜„ì¬ ëŒ“ê¸€ì˜ ê´€ê³„ë¥¼ ì¡°ì¸í•©ë‹ˆë‹¤.
              AND
                NOT CYCLE -- ì‚¬ì´í´(ë£¨í”„ë°œìƒ)ì„ ë°©ì§€í•©ë‹ˆë‹¤.
        )
        --ğŸ”¥ 3. View ì¿¼ë¦¬ ğŸ”¥
        SELECT DISTINCT ON (path)
            commentId,
            boardId,
            lpad(' ', level) || content AS content, -- ë ˆë²¨ì— ë”°ë¼ ë“¤ì—¬ì“°ê¸°í•˜ì—¬ ëŒ“ê¸€ì„ í‘œì‹œí•©ë‹ˆë‹¤.
            createdAt,
            username,
            nickname,
            parentCommentId,
            status,
            path,
            level
        FROM
            CommentHierarchy
        WHERE
            status = 'N' -- í™œì„±í™”ëœ ëŒ“ê¸€ë§Œ ì„ íƒí•©ë‹ˆë‹¤.
        ORDER BY
            path;
    </select>

    <!-- 1. ìµœìƒìœ„ ëŒ“ê¸€ ì„ íƒ: ì‹œì‘ ì¡°ê±´ ì¿¼ë¦¬ëŠ” ìµœìƒìœ„ ëŒ“ê¸€(ë¶€ëª¨ ëŒ“ê¸€ì´ ì—†ëŠ” ëŒ“ê¸€)ì„ ì„ íƒí•©ë‹ˆë‹¤. ì´ê²ƒë“¤ì€ ëŒ“ê¸€ ê³„ì¸µ êµ¬ì¡°ì˜ ê°€ì¥ ë†’ì€ ë ˆë²¨ì— í•´ë‹¹í•©ë‹ˆë‹¤.
         2. ì¬ê·€ì ì¸ í•˜ìœ„ ëŒ“ê¸€ ì„ íƒ: ì¬ê·€ ì¿¼ë¦¬ íŒŒíŠ¸ëŠ” ì„ íƒí•œ ìµœìƒìœ„ ëŒ“ê¸€ì—ì„œë¶€í„° ì‹œì‘í•˜ì—¬ í•˜ìœ„ ëŒ“ê¸€ì„ ì¬ê·€ì ìœ¼ë¡œ ì°¾ì•„ëƒ…ë‹ˆë‹¤.
            ì´ ë‹¨ê³„ì—ì„œëŠ” ê° í•˜ìœ„ ëŒ“ê¸€ì˜ ë ˆë²¨ì„ ì¦ê°€ì‹œí‚¤ê³ , ìƒìœ„ ëŒ“ê¸€ì˜ ê²½ë¡œì— í•˜ìœ„ ëŒ“ê¸€ì„ ì¶”ê°€í•˜ì—¬ ê³„ì¸µ êµ¬ì¡°ë¥¼ êµ¬ì„±í•©ë‹ˆë‹¤.
            ë˜í•œ ì‚¬ì´í´(ë¬´í•œ ë£¨í”„)ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì´ë¯¸ ì„ íƒí•œ ëŒ“ê¸€ì€ ë‹¤ì‹œ ì„ íƒí•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.
         3. View ì¿¼ë¦¬ ë° ê²°ê³¼ ë°˜í™˜: ë§ˆì§€ë§‰ ë‹¨ê³„ì—ì„œëŠ” ê³„ì¸µ êµ¬ì¡°ë¥¼ ì¬êµ¬ì„±í•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì œê³µí•  ìµœì¢… ê²°ê³¼ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
            ë ˆë²¨ì— ë”°ë¼ ë“¤ì—¬ì“°ê¸°ë¥¼ ì ìš©í•˜ì—¬ ëŒ“ê¸€ì„ í‘œì‹œí•˜ê³ , í™œì„±í™”ëœ ëŒ“ê¸€ë§Œ ì„ íƒí•©ë‹ˆë‹¤.
            ê²½ë¡œ(path)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¤‘ë³µëœ ê²°ê³¼ë¥¼ ì œê±°í•˜ì—¬ ìµœì¢… ê²°ê³¼ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.

            ì´ë ‡ê²Œ í•˜ë©´ ìµœìƒìœ„ ëŒ“ê¸€ë¶€í„° ì‹œì‘í•˜ì—¬ í•˜ìœ„ ëŒ“ê¸€ê¹Œì§€ ëª¨ë‘ ê°€ì ¸ì™€ì„œ ê³„ì¸µí˜• êµ¬ì¡°ë¡œ í‘œì‹œí•˜ë©°, ì‚¬ì´í´ì„ ë°©ì§€í•˜ì—¬ ë¬´í•œ ë°˜ë³µì„ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
            ì´ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•˜ë©´ ê³„ì¸µí˜• ëŒ“ê¸€ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê³  ì‚¬ìš©ìì—ê²Œ ì´í•´í•˜ê¸° ì‰½ê²Œ í‘œì‹œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.-->


    <!-- í…Œì´ë¸”ì˜ ë ˆë²¨ ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ -->
    <update id="updateBoardLevel" parameterType="com.example.first.dto.CommentDto">
        UPDATE postgres.first_project.comments
        SET level = #{level}
        WHERE comment_id = #{commentId};
    </update>


    <!-- ëŒ“ê¸€ ìƒì„± ì¿¼ë¦¬ -->
    <insert id="createComment" parameterType="com.example.first.dto.CommentDto" >
        INSERT INTO postgres.first_project.comments (board_id, content, username,nickname, created_at, parent_comment_id, status)
        VALUES (#{boardId}, #{content}, #{username}, #{nickname}, #{createdAt}, #{parentCommentId}, #{status})
            RETURNING comment_id;
    </insert>

    <!-- ëŒ“ê¸€ ìˆ˜ì • ì¿¼ë¦¬ -->
    <update id="updateComment" parameterType="java.lang.Long">
        UPDATE postgres.first_project.comments
        SET content = #{content}
        WHERE comment_id = #{commentId}
    </update>

    <!-- ëŒ“ê¸€ ì‚­ì œ ì¿¼ë¦¬ -->
    <delete id="deleteComment" parameterType="java.lang.Long">
        UPDATE postgres.first_project.comments
        SET status = 'Y'
        WHERE comment_id = #{commentId};
    </delete>

    <!--íŠ¹ì • ëŒ“ê¸€ í•˜ë‚˜ select-->
    <select id="findCommentByCommentId" parameterType="java.lang.Long" resultType="com.example.first.dto.CommentDto" >
        SELECT *
        FROM postgres.first_project.comments
        WHERE comment_id = #{commentId}
          AND status = 'N'
    </select>


    <!-- boardIdë¡œ ë©€í‹°íŒŒì¼ ì›ë³¸ ì´ë¦„ ê°€ì ¸ì˜¤ê¸° -->
    <select id="findBoardMultiFileOriginalName" parameterType="java.lang.Long" resultType="java.lang.String" >
        SELECT file_original_name
        FROM postgres.first_project.board_multi_file
        WHERE board_id = #{boardId}
        AND status = 'N'
        ORDER BY reg_date DESC -- created_at ì—´ì„ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
            LIMIT 1 -- ê²°ê³¼ë¥¼ í•˜ë‚˜ë§Œ ê°€ì ¸ì˜¤ë„ë¡ ì œí•œí•©ë‹ˆë‹¤.
    </select>

    <!-- boardIdë¡œ ë©€í‹°íŒŒì¼ ê²½ë¡œ ê°€ì ¸ì˜¤ê¸° -->
    <select id="findBoardMultiFileSavePath" parameterType="java.lang.Long" resultType="java.lang.String" >
        SELECT save_path
        FROM postgres.first_project.board_multi_file
        WHERE board_id = #{boardId}
          AND status = 'N'
        ORDER BY reg_date DESC -- created_at ì—´ì„ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•©ë‹ˆë‹¤.
            LIMIT 1 -- ê²°ê³¼ë¥¼ í•˜ë‚˜ë§Œ ê°€ì ¸ì˜¤ë„ë¡ ì œí•œí•©ë‹ˆë‹¤.
    </select>

    <!-- boardIdë¡œ ë©€í‹°íŒŒì¼ íŒŒì¼ëª… ê°€ì ¸ì˜¤ê¸° -->
    <select id="findBoardMultiFileFileName" parameterType="java.lang.Long" resultType="java.lang.String" >
        SELECT file_name
        FROM postgres.first_project.board_multi_file
        WHERE board_id = #{boardId}
          AND status = 'N'
    </select>

    <!-- boardIdë¡œ ë©€í‹°íŒŒì¼ ê°ì²´ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° -->
    <select id="findBoardMultiFileByBoardId" parameterType="java.lang.Long" resultType="com.example.first.dto.BoardMultiFile" resultMap="BoardMultiFileResultMap">
        SELECT *
        FROM postgres.first_project.board_multi_file
        WHERE board_id = #{boardId}
          AND status = 'N'
    </select>

    <!-- fileIdë¡œ ë©€í‹°íŒŒì¼ ê°ì²´ ê°€ì ¸ì™€ì„œ ë‹¤ìš´ë¡œë“œ (ê²Œì‹œë¬¼ì—ì„œ í´ë¦­ ì‹œ )-->
    <select id="findBoardMultiFileBySeq" parameterType="java.lang.Long" resultType="com.example.first.dto.BoardMultiFile" resultMap="BoardMultiFileResultMap">
        SELECT *
        FROM postgres.first_project.board_multi_file
        WHERE seq = #{fileId}
          AND status = 'N'
    </select>

    <!-- ì‹ì´ ì €ì¥ ì¿¼ë¦¬ -->
    <select id="insertDietRecord" parameterType="com.example.first.dto.DietDto" >
        INSERT INTO postgres.first_project.diet (intake_date, intake_calories_morning, intake_calories_lunch, intake_calories_dinner, intake_result, intake_total, username)
        VALUES (#{intakeDate}, #{intakeCaloriesMorning}, #{intakeCaloriesLunch}, #{intakeCaloriesDinner},#{intakeResult}, #{intakeTotal}, #{username})
    </select>



    <!-- usernameìœ¼ë¡œ ëª¨ë“  ì‹ì´ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° -->
    <select id="findDietListByUsername" parameterType="java.lang.String" resultType="hashmap">
        SELECT *
        FROM postgres.first_project.diet
        WHERE username = #{username}
        ORDER BY intake_date;
    </select>

    <!-- usernameìœ¼ë¡œ ì˜¤ëŠ˜ì˜ ì‹ì´ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° !-->
    <select id="findDietListByUsernameDaily" parameterType="java.lang.String" resultType="com.example.first.dto.DietDto" resultMap="DietResultMap">
        SELECT *
        FROM postgres.first_project.diet
        WHERE username = #{username}
          AND DATE(intake_date) = CURRENT_DATE;
    </select>

    <!-- usernameìœ¼ë¡œ ì¼ì£¼ì¼ì¹˜ ì‹ì´ ë¦¬ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸° ! -->
    <select id="findDietListByUsernameWeekly" parameterType="java.lang.String" resultType="com.example.first.dto.DietDto" resultMap="DietResultMap">
        <![CDATA[
        SELECT *
        FROM postgres.first_project.diet
        WHERE username = #{username}
          AND DATE(intake_date) >= CURRENT_DATE - INTERVAL '6 days'
          AND DATE(intake_date) <= CURRENT_DATE
        ORDER BY intake_date;
        ]]>
    </select>

    <!-- ë­í‚¹ í˜ì´ì§€ - ëª¨ë“  ìœ ì € ì‹ì´ ê¸°ë¡ ìµœê·¼ 7ì¼ ì¡°íšŒ (ì ì • íšŸìˆ˜ ì¹´ìš´íŠ¸, ìœ ì €ë„¤ì„ ì¡°íšŒ -  ì ì • íšŸìˆ˜ê°€ ë§ì€ ìˆœìœ¼ë¡œ ) -->
    <select id="findAllUserDietListWeekly" resultType="hashmap">
        <![CDATA[
        SELECT COUNT(intake_result) AS result_good_count, username
        FROM postgres.first_project.diet
        WHERE DATE (intake_date) >= CURRENT_DATE - INTERVAL '6 days'
          AND DATE (intake_date) <= CURRENT_DATE
          AND intake_result = 'ì ì •'
        GROUP BY username
        ORDER BY result_good_count DESC;
        ]]>
    </select>
</mapper>
